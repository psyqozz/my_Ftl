/*
** ETNA PROJECT, 12/11/2018 by juzain_d
** main
** File description:
**      ...
*/

#include "ftl.h"

const game_command_t commands[] =
{
    {"attack", attack},
    // {"detect", detect},
    {"jump", jump},
    {"getbonus", get_bonus},
    {"repair_system", system_repair},
    {"control_system", system_control},
    // {"stat", stat},
    {NULL, NULL}
};


int main()
{
    char *game;
    ship_t *ship;
    ship  = create_ship();
    add_weapon_to_ship(ship);
    add_ftl_drive_to_ship(ship);
    add_navigation_tools_to_ship(ship);
    add_container_to_ship(ship);
    game = my_readline();
    while (game) {
    game_loop(ship);
    my_putstr("continue");
    game = my_readline();
    }
    free(ship);
    return (0);
}

void game_loop(ship_t *ship)
{
    char *user;
    int found = 0;
    int i = 0;
    my_putstr( "Enter a command : ");
    user = my_readline();
    if (user) {
        while (commands[i].command && !found) {
            if (my_strcmp(commands[i].command, user) == 0)
                found = 1;
            else
                i++;
        }
        if (!found && user)
            my_putstr_color("red", "[ORDER FAILURE]: unknown command\n");
        if (found)
            commands[i].fonc_comm(ship);
    } else
        my_putstr_color("red", "[ORDER FAILURE]: the control reader is blocked\n");
    free(user);
}
